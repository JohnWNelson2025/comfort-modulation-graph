<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Comfort Modulation Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 40px;
      background-color: #f9f9f9;
      transition: background-color 0.3s, color 0.3s;
    }
    canvas {
      display: block;
      margin: 0 auto;
    }
    .dashboard {
      max-width: 900px;
      margin: auto;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 10px;
      margin: 20px 0;
    }
    .controls button, .controls select {
      padding: 10px 15px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #2196F3;
      color: white;
    }
    .stats, .interpretation {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      line-height: 1.6;
    }
    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 14px;
      color: #555;
    }
    footer a {
      color: #2196F3;
      text-decoration: none;
    }
    .dark-mode {
      background-color: #1e1e1e;
      color: #eee;
    }
    .dark-mode .stats,
    .dark-mode .interpretation {
      background-color: #2c2c2c;
      color: #eee;
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <canvas id="myChart" width="800" height="600"></canvas>

    <div class="controls">
      <button onclick="toggleInterpretation()">Hide Interpretation</button>
      <button onclick="toggleTheme()">Toggle Theme</button>
      <button onclick="exportChart()">Export Chart</button>
      <select id="filterSelect" onchange="applyFilter()">
        <option value="all">Show All</option>
        <option value="Internal">Internal</option>
        <option value="Modulator">Modulator</option>
        <option value="Core">Core</option>
        <option value="Outcome">Outcome</option>
        <option value="External">External</option>
      </select>
    </div>

    <div class="stats" id="statsBox">
      <h3>ðŸ“Š Summary Stats</h3>
      <p><strong>Average Influence (x):</strong> <span id="avgX"></span></p>
      <p><strong>Average Impact (y):</strong> <span id="avgY"></span></p>
    </div>

    <div id="interpretation" class="interpretation">
      <h3>ðŸ§  Chart Interpretation</h3>
      <p>This dashboard visualizes five comfort modulation tokens across two dimensions: <strong>influence</strong> and <strong>impact</strong>. Each bubbleâ€™s position reflects its conceptual weight, while its size and color convey additional meaning:</p>
      <ul>
        <li><span style="color:#F44336;"><strong>Red</strong></span>: Internal predictors</li>
        <li><span style="color:#9C27B0;"><strong>Purple</strong></span>: Modulators</li>
        <li><span style="color:#4CAF50;"><strong>Green</strong></span>: Core hunch</li>
        <li><span style="color:#FF9800;"><strong>Orange</strong></span>: Outcomes</li>
        <li><span style="color:#2196F3;"><strong>Blue</strong></span>: External predictors</li>
      </ul>
      <p>Bubble labels identify each token directly, while tooltips reveal richer statistics and contextual insights. This chart helps viewers intuitively grasp how different factors interact to shape comfort modulation.</p>
    </div>

    <footer>
      <p>Published on GitHub Pages â€” <a href="https://github.com/johnwnelson2025/comfort-modulation-graph" target="_blank">View Repository</a></p>
      <p>Last updated: August 22, 2025</p>
    </footer>
  </div>

  <script>
    const fullData = [
      { label: 'Internal', x: -10, y: 10, r: 12, color: '#F44336' },
      { label: 'Modulator', x: -5, y: -10, r: 8, color: '#9C27B0' },
      { label: 'Core', x: 0, y: 0, r: 10, color: '#4CAF50' },
      { label: 'Outcome', x: 5, y: -10, r: 8, color: '#FF9800' },
      { label: 'External', x: 10, y: 10, r: 12, color: '#2196F3' }
    ];

    let chart;

    function createChart(data) {
      const datasets = data.map(pt => ({
        label: pt.label,
        data: [{ x: pt.x, y: pt.y, r: pt.r }],
        backgroundColor: pt.color,
        borderColor: 'rgba(0,0,0,0.1)',
        borderWidth: 1
      }));

      const config = {
        type: 'bubble',
        data: { datasets },
        options: {
          animation: {
            duration: 1000,
            easing: 'easeOutQuart'
          },
          scales: {
            x: {
              title: { display: true, text: 'Influence Axis' },
              min: -15,
              max: 15
            },
            y: {
              title: { display: true, text: 'Impact Axis' },
              min: -15,
              max: 15
            }
          },
          plugins: {
            title: {
              display: true,
              text: 'Comfort Modulation Token Relationships'
            },
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const labels = {
                    'Internal': 'Internal Predictors (Î² = -0.6)',
                    'Modulator': 'Modulators (Mediator)',
                    'Core': 'Core Hunch (Comfort Modulates Pain)',
                    'Outcome': 'Outcomes (e.g., Reduced Pain)',
                    'External': 'External Predictors (Î² = 0.7)'
                  };
                  return labels[context.dataset.label];
                }
              }
            },
            datalabels: {
              align: 'center',
              anchor: 'center',
              font: {
                weight: 'bold',
                size: 12
              },
              formatter: function(value, context) {
                return context.dataset.label;
              },
              color: '#000'
            }
          }
        },
        plugins: [ChartDataLabels]
      };

      if (chart) {
        chart.data.datasets = config.data.datasets;
        chart.update();
      } else {
        chart = new Chart(document.getElementById('myChart'), config);
      }

      updateStats(data);
    }

    function updateStats(data) {
      const avgX = data.reduce((sum, pt) => sum + pt.x, 0) / data.length;
      const avgY = data.reduce((sum, pt) => sum + pt.y, 0) / data.length;
      document.getElementById('avgX').textContent = avgX.toFixed(2);
      document.getElementById('avgY').textContent = avgY.toFixed(2);
    }

    function applyFilter() {
      const selected = document.getElementById('filterSelect').value;
      const filtered = selected === 'all' ? fullData : fullData.filter(pt => pt.label === selected);
      createChart(filtered);
    }

    function toggleInterpretation() {
      const section = document.getElementById('interpretation');
      const button = document.querySelector('.controls button');
      if (section.style.display === 'none') {
        section.style.display = 'block';
        button.textContent = 'Hide Interpretation';
      } else {
        section.style.display = 'none';
        button.textContent = 'Show Interpretation';
      }
    }

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
    }

    function exportChart() {
      const link = document.createElement('a');
      link.download = 'comfort-modulation-chart.png';
      link.href = document.getElementById('myChart').toDataURL();
      link.click();
    }

    // Initialize chart with full data
    createChart(fullData);
  </script>
</body>
</html>